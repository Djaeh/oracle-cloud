# Kubernetes cluster on Oracle cloud

Terraform script to create a kubernetes cluster on Oracle cloud.

## Requirements 

### Tools

- [Oracle cloud infrastructure (OCI)](https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm#Quickstart)
- [Terraform](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)
- [Kubecttl](https://kubernetes.io/docs/tasks/tools/)

### Environnement variables

Value to be retreive and set according to oracle cloud account:

- ```TF_VAR_compartment_ocid``` Compartment in which the cluster needs to be created.
- ```TF_VAR_tenancy_ocid``` Tenancy OCID of the oracle account.
- ```TF_VAR_user_ocid``` User OCID with sufficient write to create objects on the choosen compartement. 
- ```TF_VAR_region``` Region for the cluster

Value to be created using the command ```oci setup config``` and following the instruction. *There is currently an issue when adding a passcode to the private key*:

- ```TF_VAR_private_key_path``` Private key generated by oci config.
- ```TF_VAR_fingerprint``` Fingerprint of the SSH key added to the user.
- ```TF_VAR_ssh_public_key``` public key to be registered to access kubernetes clusters.

## Installing kubernetes cluster 

```sh
cd oci-infra
terraform apply
```

## Access kubernetes cluster
Create the kube config using oci:
```sh 
oci ce cluster create-kubeconfig --cluster-id <kubernetes-cluster-id> --file ~/.kube/home-labs-config --region <region> --token-version 2.0.0 --kube-endpoint PUBLIC_ENDPOINT
```
set the environnement variable
```sh
export KUBECONFIG=~/.kube/home-labs-config
```
Access using kubectl (or any other tool)
```sh
kubectl get nodes
```

## References and useful links
- [Running A Free Kubernetes Cluster On Oracle Cloud](https://arnoldgalovics.com/free-kubernetes-oracle-cloud/)
- [Free Oracle Cloud Kubernetes Cluster With Terraform](https://arnoldgalovics.com/oracle-cloud-kubernetes-terraform/)
- [Exposing Apps From An Oracle Kubernetes Cluster Using A Network Load Balancer For Free](https://arnoldgalovics.com/oracle-kubernetes-free-network-load-balancer/)
- [GitHub Actions CI/CD For Oracle Cloud Kubernetes](https://arnoldgalovics.com/github-actions-oracle-cloud-kubernetes/)
- [Boris gitlab](https://gitlab.com/lam-bo-home-labs/oracle-cloud-infra-terraform)
